# 键值设计

- 遵循基本格式：[业务]:[数据名]:[id]

- 长度不超过 44 字节

- 不包含特殊字符

## bigkey

通常以 key 的大小和 value 中的成员数量来综合判断

1. key 本身很大
2. value 中的成员过多或数据量大
3. 一个 kv 的内存占用包括 key 本身、value 数据、其他数据结构

推荐标准：

- 单个 key 的 value 小于 10kb
- 对于集合类型，建议元素数量小于 1000

### bigkey 带来的问题

- 网络阻塞：读请求时，少量 QPS 就会将带宽占满，导致实例乃至物理机变慢
- 数据倾斜：切片集群下，bigkey 会导致当前切片实例内存明显高于其他实例，导致失去均衡
- Redis 阻塞：bigkey 之间做集合运算，非常耗时，阻塞 redis
- CPU 压力：对 bigkey 的数据序列化、反序列化会导致 CPU 使用率飙升

### 找到 bigkey

- Redis-cli --bigkeys 
- scan 扫描
- 网络监控，监控 redis 的网络数据

### 删除 bigkey

因为 bigkey 占用内存较多，因此删除它会耗费很长时间

可以使用异步删除命令 `unlink`

## 选择合适数据类型

1. `hash` 中的成员数量较多时，会使用哈希表存储，而不是  `ziplist`，内存占用较多
2. 合理拆分数据
3. 设置合理超时时间
# 外键

外键 Foreign Key 是数据库中的一个概念，用来建立表之间的关联，主要用于保持数据的一致性和完整性

外键是一个表中的字段（或字段组合），其值必须匹配另一个表的主键（或唯一键）的值。通过外键，可以建立两个表之间的从属关系：

- 主表：被外键引用的表，包含被引用的主键或唯一键。
- 从表：包含外键字段的表，其外键值依赖于主表

## 作用

- 数据完整性：确保子表中的外键值必须在主表中存在，防止无效数据
- 级联操作：当主表数据变更时，自动触发子表的更新或删除，避免孤儿数据
- 维护表间逻辑关系：明确表之间的关联，使数据库设计更清晰

常见级联操作有：

- `ON DELETE CASCADE`：删除父表记录时，自动删除关联的子表记录
- `ON DELETE SET NULL`：删除父表记录时，子表关联字段自动设为 `NULL`
- `ON DELETE RESTRICT`：默认行为，拒绝删除被引用的父表记录
- `ON UPDATE CASCADE`：父表主键更新时，自动更新子表外键值
- `ON UPDATE SET NUL`：父表主键更新时，子表外键设为 `NULL`

```sql
-- 创建主表
CREATE TABLE users (
    user_id INT PRIMARY KEY,
    name VARCHAR(50)
);

-- 创建子表，定义外键约束
CREATE TABLE orders (
    order_id INT PRIMARY KEY,
    user_id INT,
    amount DECIMAL(10,2),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE
        ON UPDATE RESTRICT
);
```

## 注意事项

- 外键约束会在插入、更新或删除时触发检查，可能对性能有轻微影响。建议为外键字段创建索引
- 适合需要强数据一致性的场景
- 高并发写入场景中，可能需权衡外键约束与性能
- 仅在 InnoDB 中有效，MyISAM 等引擎不支持外键
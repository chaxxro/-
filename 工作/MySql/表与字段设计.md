# 表与字段设计

## 数据库基本设计规范

1. 尽量控制单表数据量的大小，建议控制在 500 万以下。500 万并不是 MySQL 数据库的限制，但过大的数据表会造成修改表结构、备份、恢复都会有很大的问题，可以用历史数据归档（应用于日志数据），分库分表（应用于业务数据）等手段来控制数据量大小
2. 谨慎使用 MySQL 分区表。分区表在物理上表现为多个文件，在逻辑上表现为一个表。谨慎选择分区键，跨分区查询效率可能更低，建议采用物理分表的方式管理大数据
3. 禁止在数据库中存储图片、文件等大的二进制数据。通常大文件会短时间内造成数据量快速增长。进行数据库读取时，通常会进行大量的随机 IO 操作，文件很大时 IO 操作很耗时。通常大文件存储于文件服务器，数据库只存储文件地址信息

## 数据库字段设计规范

1. 优先选择符合存储需要的最小的数据类型。列的字段越大，建立索引时所需要的空间也就越大，这样一页中所能存储的索引节点的数量也就越少，在遍历时所需要的 IO 次数也就越多，索引的性能也就越差
2. 避免使用 TEXT、BLOB 数据类型
3. 尽可能把所有列定义为 NOT NULL

## 索引设计规范

1. 限制每张表上的索引数量，建议单张表索引不超过 5 个
2. 禁止给表中的每一列都建立单独的索引
3. 每个 InnoDB 表必须有个主键
4. 区分度最高的放在联合索引的最左侧
5. 尽量把字段长度小的列放在联合索引的最左侧
6. 使用最频繁的列放到联合索引的左侧

## SQL 开发规范

1. 充分利用表上已经存在的索引，避免使用双 % 号的查询条件
2. 禁止使用 `SELECT *`
3. 避免使用子查询，可以把子查询优化为 JOIN 操作
4. 避免使用 JOIN 关联太多的表

## 范式与反范式

- 第一范式：表中所有字段都是不可再分的，每个字段的值都只能是单一值
- 第二范式：表中必须存在业务主键，并且非主键依赖于全部业务主键
- 第三范式：表中的非主键列之间不能相互依赖

反范式的过程就是通过冗余数据来提高查询性能，但冗余数据会牺牲数据一致性

- 所有的数据都在同一张表中，可以减少表关联
- 更好进行索引优化
- 存在大量冗余数据
- 数据维护成本更高
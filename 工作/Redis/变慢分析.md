# 变慢分析

## 发现手段

1. 在服务端使用 redis-cli 的 `–intrinsic-latency` 监测和统计测试期间内的最大延迟
2. slowlog 命令可以快速定位到那些超出指定执行时间的慢命令，默认情况下命令若是执行时间超过 10ms 就会被记录到日志

## 可能原因

### 网络通信

一次命令需要一次 rtt 网络耗时

优先使用批处理命令，不支持批处理的操作优先使用 pipeline

### 慢指令

O(n) 命令的执行会拖慢系统，优先使用增量方式命令如 `SCAN`、`SSCAN` 等

### RDB

fork 进程时会复制大量链接对象，一个 24 GB 的大型 Redis 实例需要 24 GB / 4 kB * 8 = 48 MB 的页表

### 内存大页

fork 的 COW 配合大内存页面，在写的指令比较多的时候会导致大量的拷贝，导致性能变慢

### AOF

AOF 的落盘和重写，都会有 IO 操作，导致性能变慢

### 缓存淘汰

定时缓存淘汰会导致性能变慢

### bigkey

bigkey 的读请求会占用大量带宽，bigkey 的删除都会导致性能变慢



